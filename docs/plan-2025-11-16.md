# Next.js ブログ実装プラン
**作成日**: 2025-11-16
**目的**: Jupyter Bookを使わず、Next.js App Routerで`src/blog`内のMarkdownファイルを表示するブログシステムを構築

---

## 📋 現状分析

### 既存のブログコンテンツ構造
```
src/blog/
├── intro.md                    # トップページ
├── note/                       # 研究ノート (8ファイル)
├── papers/                     # 論文レポート (6ファイル)
├── project/                    # プロジェクト報告 (1ファイル)
└── dialogs/                    # 対話ログ (2ファイル)
```

### 要件
- `/blog` ルートでブログのトップページを表示
- `/blog/note/[slug]` で各記事を表示
- `/blog/papers/[slug]` で論文レポートを表示
- `/blog/project/[slug]` でプロジェクト報告を表示
- `/blog/dialogs/[slug]` で対話ログを表示
- Markdownファイルを動的に読み込んで表示
- 日本語タイトルとメタデータに対応
- レスポンシブデザイン
- ダークモード対応（既存テーマに統一）

---

## 🎯 実装フェーズ

### Phase 1: Markdown処理の基盤構築
**目標**: Markdownファイルを読み込み、HTMLに変換する仕組みを作る

#### 1.1 必要なパッケージのインストール
```bash
npm install gray-matter remark remark-gfm remark-rehype rehype-stringify rehype-slug rehype-prism-plus
npm install -D @types/node
```

- `gray-matter`: Markdownのフロントマター（メタデータ）を解析
- `remark`: Markdownパーサー
- `remark-gfm`: GitHub Flavored Markdown対応（テーブル、タスクリストなど）
- `remark-rehype`: Remark（Markdown）からRehype（HTML）へのブリッジ
- `rehype-stringify`: HTMLとして文字列化
- `rehype-slug`: 見出しに自動的にIDを付与（目次用）
- `rehype-prism-plus`: サーバーサイドでのシンタックスハイライト（Prism.js）

**パフォーマンス最適化**: シンタックスハイライトをビルド時に実行することで、クライアント側のJavaScriptを削減し、Core Web Vitals（FCP/LCP）を改善します。

#### 1.2 ブログコンテンツ用のユーティリティ関数作成
**ファイル**: `src/lib/blog.ts`

機能:
- Markdownファイルの一覧取得
- 特定カテゴリ（note, papers, project, dialogs）のファイル取得
- Markdownファイルの読み込みとパース
- フロントマターの抽出
- Markdown → HTML変換（サーバーサイドでシンタックスハイライト付き）
- スラッグ（URL用のID）生成

**実装方針**:
- **ファイルシステムアクセス**: Node.jsの`fs/promises`と`path`を使用
- **静的サイト生成（SSG）**: ビルド時に全記事を静的生成し、最高のパフォーマンスを実現
- **型安全性**: TypeScriptで全てのデータ構造を定義

**主要な関数**:
- `getAllPostSlugs()`: `generateStaticParams`用の全記事パス取得
- `getPostsByCategory(category)`: カテゴリ内の全記事を取得（日付降順）
- `getPostBySlug(category, slug)`: 特定の記事を取得
- `markdownToHtml(markdown)`: MarkdownをHTMLに変換（シンタックスハイライト付き）

**Content Root Directory**: `process.cwd()/src/blog/blog`から相対パスで記事を読み込む

### Phase 2: ブログページのルーティング構築
**目標**: App Routerでブログページを作成

#### 2.1 トップページ: `/blog`
**ファイル**: `src/app/blog/page.tsx`

機能:
- `intro.md`の内容を表示
- 各カテゴリ（Research Notes, Papers, Projects, Dialogs）のリンク一覧
- カード形式でコンテンツを整理

#### 2.2 カテゴリページ: `/blog/[category]`
**ファイル**: `src/app/blog/[category]/page.tsx`

機能:
- `note`, `papers`, `project`, `dialogs`をdynamic routeで処理
- 各カテゴリの記事一覧を表示
- 記事タイトル、日付、概要を表示

#### 2.3 記事詳細ページ: `/blog/[category]/[slug]`
**ファイル**: `src/app/blog/[category]/[slug]/page.tsx`

機能:
- Markdownファイルの内容を表示
- タイトル、日付、本文を整形
- コードブロックのシンタックスハイライト
- 前/次の記事へのナビゲーション

### Phase 3: UIコンポーネントの実装
**目標**: ブログ表示用の再利用可能なコンポーネントを作成

#### 3.1 コンポーネント一覧
**ディレクトリ**: `src/components/blog/`

- `BlogLayout.tsx`: ブログページ共通レイアウト
- `BlogCard.tsx`: 記事カード（一覧表示用）
- `MarkdownContent.tsx`: Markdown表示コンポーネント
- `CategoryNav.tsx`: カテゴリナビゲーション
- `TableOfContents.tsx`: 目次コンポーネント（見出しから自動生成）

#### 3.2 スタイリング
- Tailwind CSSで統一
- 既存のダークモードテーマに統合
- レスポンシブ対応（モバイル/タブレット/デスクトップ）

### Phase 4: メタデータとSEO対応
**目標**: 検索エンジン最適化とOGP設定

#### 4.1 メタデータの設定
- 各ページに適切な`metadata`を設定
- タイトル、説明、OGP画像
- 構造化データ（JSON-LD）の追加

#### 4.2 サイトマップとRSS
- `sitemap.xml`の自動生成
- RSSフィード（オプション）

### Phase 5: 拡張機能（オプション）
**目標**: ユーザー体験の向上

#### 5.1 検索機能
- クライアントサイドでの全文検索
- 記事タイトル、本文からの検索

#### 5.2 タグ/カテゴリフィルター
- 記事にタグを追加
- タグによるフィルタリング

#### 5.3 コードブロックの機能強化
- ✅ **シンタックスハイライト**: Phase 1で`rehype-prism-plus`により実装済み（サーバーサイド処理）
- コピーボタン（クライアントコンポーネント）
- 行番号表示（CSSまたはPrismプラグイン）

---

## 📁 ディレクトリ構造（実装後）

```
src/
├── app/
│   └── blog/
│       ├── page.tsx                    # /blog トップ
│       ├── [category]/
│       │   ├── page.tsx                # /blog/note など
│       │   └── [slug]/
│       │       └── page.tsx            # /blog/note/slug など
│       └── layout.tsx                  # ブログ共通レイアウト
├── components/
│   └── blog/
│       ├── BlogLayout.tsx
│       ├── BlogCard.tsx
│       ├── MarkdownContent.tsx
│       ├── CategoryNav.tsx
│       └── TableOfContents.tsx
├── lib/
│   └── blog.ts                         # ブログユーティリティ関数
└── blog/
    ├── intro.md
    ├── note/
    ├── papers/
    ├── project/
    └── dialogs/
```

---

## 🔧 技術スタック

### コア技術
- **Next.js 15** (App Router)
- **TypeScript**
- **Tailwind CSS**

### Markdown処理
- **gray-matter**: フロントマター解析
- **remark**: Markdownパーサー
- **remark-gfm**: GitHub Flavored Markdown対応
- **remark-rehype**: Markdown AST → HTML AST変換
- **rehype-stringify**: HTML文字列化
- **rehype-slug**: 見出しID自動付与（目次生成用）
- **rehype-prism-plus**: サーバーサイドシンタックスハイライト

### スタイリング
- **Tailwind CSS v4**: 既存テーマに統合
- **@tailwindcss/typography** (オプション): Markdown用のタイポグラフィ

---

## 🎨 デザインガイドライン

### カラースキーム
- 既存のダークモードテーマに統一
- プライマリ: 既存のアクセントカラー
- テキスト: 高コントラスト（アクセシビリティ対応）

### タイポグラフィ
- 見出し: ヒエラルキーを明確に
- 本文: 読みやすいフォントサイズ（16px以上）
- コードブロック: モノスペースフォント

### レスポンシブブレークポイント
- モバイル: < 640px
- タブレット: 640px - 1024px
- デスクトップ: > 1024px

---

## ✅ チェックリスト

### Phase 1: 基盤構築
- [ ] パッケージインストール（gray-matter, remark, rehype系）
- [ ] `src/lib/blog.ts` 作成
- [ ] Markdownファイル読み込み機能（fs/promises）
- [ ] フロントマター解析機能（gray-matter）
- [ ] Markdown → HTML変換機能（remark + rehype pipeline）
- [ ] サーバーサイドシンタックスハイライト（rehype-prism-plus）

### Phase 2: ルーティング
- [ ] `/blog` トップページ
- [ ] `/blog/[category]` カテゴリページ
- [ ] `/blog/[category]/[slug]` 記事詳細ページ
- [ ] 動的メタデータ生成

### Phase 3: UIコンポーネント
- [ ] BlogLayout コンポーネント
- [ ] BlogCard コンポーネント
- [ ] MarkdownContent コンポーネント
- [ ] CategoryNav コンポーネント
- [ ] ダークモード対応

### Phase 4: SEO
- [ ] メタデータ設定
- [ ] OGP設定
- [ ] sitemap.xml生成

### Phase 5: 拡張機能（オプション）
- [ ] 検索機能
- [ ] タグフィルター
- [ ] コピーボタン・行番号表示
- [ ] 目次自動生成（rehype-slugで基盤は完成）

---

## 🚀 実装開始

**優先順位**: Phase 1 → Phase 2 → Phase 3
**Phase 4, 5はオプション**: 基本機能が動作してから追加

---

## 📝 備考

### Jupyter Bookからの移行理由
1. **Python環境の依存性**: Python 3.10/3.11が必要でメンテナンスが煩雑
2. **ビルドプロセスの複雑さ**: 別プロセスでビルドが必要
3. **Next.jsとの統合**: 静的HTMLをコピーするより、Next.jsで直接レンダリングする方がシンプル
4. **カスタマイズの柔軟性**: React/Next.jsで完全にコントロール可能

### 利点
- **単一言語**: TypeScript/JavaScriptのみ
- **統合されたビルド**: Next.jsのビルドプロセスに完全統合
- **開発体験**: ホットリロード、TypeScript型チェック
- **デプロイの簡素化**: Dockerイメージも単一のNode.jsベース
